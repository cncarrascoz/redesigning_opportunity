{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 135, "column": 0}, "map": {"version":3,"sources":["file:///Users/ericvasquez/Downloads/Local/Classes/Y4/Spring/CS1060/evasquez25-hw6/src/app/api/openai/route.ts"],"sourcesContent":["// app/api/openai/route.ts\nimport { NextRequest, NextResponse } from 'next/server';\nimport OpenAI from 'openai';\n\n// Initialize OpenAI client\nconst openai = new OpenAI({\n  apiKey: process.env.OPENAI_API_KEY,\n  dangerouslyAllowBrowser: false\n});\n\n// Check if API key is configured\nif (!process.env.OPENAI_API_KEY) {\n  console.error('OPENAI_API_KEY is not configured in environment variables');\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { address, income, children } = body;\n\n    if (!address) {\n      return NextResponse.json(\n        { error: 'Address is required' },\n        { status: 400 }\n      );\n    }\n\n    // Validate input data\n    if (!Array.isArray(children)) {\n      return NextResponse.json(\n        { error: 'Children data must be an array' },\n        { status: 400 }\n      );\n    }\n\n    const completion = await openai.chat.completions.create({\n      model: \"gpt-3.5-turbo-1106\", // Using a more reliable model\n      messages: [\n        {\n          role: \"system\",\n          content: `You are an AI assistant that provides personalized recommendations for families looking to \n                    improve their children's future opportunities in their current location. Format your response as valid JSON. \n                    Your entire response must be valid JSON that can be parsed with JSON.parse().`\n        },\n        {\n          role: \"user\",\n          content: `Generate detailed, personalized recommendations for a family living at this address: ${address}.\n                    Additional family information:\n                    - Annual household income: ${income}\n                    - Children: ${JSON.stringify(children)}\n                    \n                    Please include the following in your JSON response (your entire response must be valid JSON):\n                    \n                    1. townData: Information about their current town/city including name, website, and description.\n                    \n                    2. schoolData: Array of school recommendations with:\n                       - name, rating (1-10), description, website\n                       - schoolType: \"elementary\", \"middle\", \"high\", or \"all\" based on grade levels\n                       - Make sure each school is appropriate for the children's ages:\n                         * Ages 5-10: elementary schools\n                         * Ages 11-13: middle schools\n                         * Ages 14-18: high schools\n                    \n                    3. communityProgramData: Array of recommendations with:\n                       - name, description, website\n                       - ageRanges: Array of [\"preschool\", \"elementary\", \"middle\", \"high\", \"all\"]\n                       - genderFocus: \"all\", \"boys\", or \"girls\" if applicable\n                       - tags: Array of relevant categories like \"stem\", \"arts\", \"sports\", etc.\n                       - Make recommendations based on the children's ages, genders, and family income\n                    \n                    Format everything as valid JSON.`\n        }\n      ]\n    });\n\n    // Extract the response content\n    const responseContent = completion.choices[0].message.content;\n    \n    if (!responseContent) {\n      throw new Error('No content in the OpenAI response');\n    }\n\n    try {\n      // Parse the JSON response\n      const recommendations = JSON.parse(responseContent);\n      return NextResponse.json(recommendations);\n    } catch (parseError) {\n      console.error('Error parsing OpenAI response:', parseError);\n      console.log('Raw response:', responseContent);\n      throw new Error('Failed to parse the AI response as JSON');\n    }\n  } catch (error) {\n    console.error('Error in OpenAI API call:', error);\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    return NextResponse.json(\n      { error: 'Failed to generate recommendations', details: errorMessage },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"AAAA,0BAA0B;;;;AAC1B;AACA;;;AAEA,2BAA2B;AAC3B,MAAM,SAAS,IAAI,kJAAA,CAAA,UAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;IAClC,yBAAyB;AAC3B;AAEA,iCAAiC;AACjC,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,QAAQ,KAAK,CAAC;AAChB;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,QAAQ,EAAE,GAAG;QAEtC,IAAI,CAAC,SAAS;YACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,sBAAsB;QACtB,IAAI,CAAC,MAAM,OAAO,CAAC,WAAW;YAC5B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACtD,OAAO;YACP,UAAU;gBACR;oBACE,MAAM;oBACN,SAAS,CAAC;;iGAE6E,CAAC;gBAC1F;gBACA;oBACE,MAAM;oBACN,SAAS,CAAC,qFAAqF,EAAE,QAAQ;;+CAEpE,EAAE,OAAO;gCACxB,EAAE,KAAK,SAAS,CAAC,UAAU;;;;;;;;;;;;;;;;;;;;;oDAqBP,CAAC;gBAC7C;aACD;QACH;QAEA,+BAA+B;QAC/B,MAAM,kBAAkB,WAAW,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QAE7D,IAAI,CAAC,iBAAiB;YACpB,MAAM,IAAI,MAAM;QAClB;QAEA,IAAI;YACF,0BAA0B;YAC1B,MAAM,kBAAkB,KAAK,KAAK,CAAC;YACnC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAC3B,EAAE,OAAO,YAAY;YACnB,QAAQ,KAAK,CAAC,kCAAkC;YAChD,QAAQ,GAAG,CAAC,iBAAiB;YAC7B,MAAM,IAAI,MAAM;QAClB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QACrE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;YAAsC,SAAS;QAAa,GACrE;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 235, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}